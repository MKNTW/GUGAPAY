
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>История операций — GugaPay</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f5; padding: 20px; }
    #block-history { background: white; padding: 20px; border-radius: 8px; list-style: none; }
    #block-history li { padding: 6px 0; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>

<div id="hash-ui">
  <h2>История операций с блоками</h2>
  <ul id="block-history">
    <li>Загрузка истории...</li>
  </ul>
</div>

<script>
  const hostname = window.location.hostname;
  const API_URL = "https://api.gugapay.ru";

  if (hostname === "hash.gugapay.ru") {
    document.addEventListener("DOMContentLoaded", async () => {
      const historyList = document.getElementById("block-history");

      try {
        const res = await fetch(`${API_URL}/history`, {
          credentials: 'include'
        });
        const data = await res.json();
        historyList.innerHTML = "";

        if (Array.isArray(data) && data.length > 0) {
          data.forEach(op => {
            const li = document.createElement("li");
            li.textContent = op.description || JSON.stringify(op);
            historyList.appendChild(li);
          });
        } else {
          historyList.innerHTML = "<li>Операции не найдены.</li>";
        }
      } catch (err) {
        historyList.innerHTML = "<li>Ошибка загрузки истории.</li>";
        console.error(err);
      }
    });
  } else {
    document.body.innerHTML = "<h2>Доступ запрещён</h2><p>Этот интерфейс доступен только на <b>hash.gugapay.ru</b>.</p>";
  }
</script>

</body>
</html>
